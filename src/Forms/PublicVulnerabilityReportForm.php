<?php

namespace Whozidis\HallOfFame\Forms;

use Botble\Base\Forms\FormAbstract;
use Whozidis\HallOfFame\Http\Requests\PublicVulnerabilityReportRequest;
use Whozidis\HallOfFame\Models\VulnerabilityReport;

class PublicVulnerabilityReportForm extends FormAbstract
{
    public function buildForm(): void
    {
        // Hall of Fame forms don't use CMS authentication

        $this
            ->setupModel(new VulnerabilityReport())
            ->setValidatorClass(PublicVulnerabilityReportRequest::class)
            ->setFormOption('template', 'plugins/hall-of-fame::forms.public')
            ->setFormOption('enctype', 'multipart/form-data')
            ->setFormOption('id', 'vulnerability-report-form')
            ->setFormOption('class', 'vulnerability-report-form')
            ->add('title', 'text', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_title'),
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_title_placeholder'),
                    'data-counter' => 120,
                ],
            ])
            ->add('vulnerability_type', 'text', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_vulnerability_type'),
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_vulnerability_type_placeholder'),
                    'data-counter' => 255,
                ],
            ])
            ->add('endpoint', 'text', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_endpoint'),
                'label_attr' => ['class' => 'control-label'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_endpoint_placeholder'),
                    'data-counter' => 255,
                ],
            ])
            ->add('description', 'textarea', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_description'),
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_description_placeholder'),
                    'rows' => 5,
                ],
            ])
            ->add('impact', 'textarea', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_impact'),
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_impact_placeholder'),
                    'rows' => 5,
                ],
            ])
            ->add('steps_to_reproduce', 'textarea', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_steps_to_reproduce'),
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_steps_to_reproduce_placeholder'),
                    'rows' => 5,
                ],
            ])
            ->add('suggested_fix', 'textarea', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_suggested_fix'),
                'label_attr' => ['class' => 'control-label'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_suggested_fix_placeholder'),
                    'rows' => 5,
                ],
            ])
            ->add('attachments', 'file', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_attachments'),
                'label_attr' => ['class' => 'control-label'],
                'attr' => [
                    'multiple' => true,
                    'class' => 'form-control file-input',
                    'accept' => 'image/*,.txt,.pdf,.doc,.docx,.xls,.xlsx,.zip,.rar,application/octet-stream',
                ],
            ])
            ->add('researcher_info', 'html', [
                'html' => '<h4 class="form-section mt-3">' . trans('plugins/hall-of-fame::hall-of-fame.form_researcher_info') . '</h4>',
            ])
            ->add('researcher_name', 'text', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_researcher_name'),
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_researcher_name_placeholder'),
                    'data-counter' => 255,
                ],
            ])
            ->add('researcher_bio', 'textarea', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_researcher_bio'),
                'label_attr' => ['class' => 'control-label'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_researcher_bio_placeholder'),
                    'rows' => 3,
                ],
            ])
            ->add('researcher_email', 'email', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_researcher_email'),
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => trans('plugins/hall-of-fame::hall-of-fame.form_researcher_email_placeholder'),
                    'data-counter' => 255,
                ],
            ])
            ->add('privacy_policy', 'checkbox', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_privacy_policy'),
                'label_attr' => ['class' => 'control-label required'],
                'wrapper' => [
                    'class' => 'form-check mt-3',
                ],
            ])
            ->add('captcha', 'captcha', [
                'wrapper' => [
                    'class' => 'form-group mb-3',
                ],
                'label' => 'Captcha',
                'label_attr' => ['class' => 'control-label required'],
                'attr' => [
                    'placeholder' => 'Enter the characters from the image',
                    'class' => 'form-control',
                ],
            ])
            ->add('submit', 'submit', [
                'label' => trans('plugins/hall-of-fame::hall-of-fame.form_submit'),
                'attr' => [
                    'class' => 'btn btn-primary',
                ],
            ]);
    }
}
